# 커스텀 서브에이전트 생성하기

> Claude Code에서 작업별 워크플로우와 향상된 컨텍스트 관리를 위한 특화된 AI 서브에이전트를 생성하고 사용하세요.

서브에이전트는 특정 유형의 작업을 처리하는 특화된 AI 어시스턴트입니다. 각 서브에이전트는 자체 컨텍스트 윈도우에서 실행되며, 커스텀 시스템 프롬프트, 특정 도구 액세스 및 독립적인 권한을 가집니다. Claude가 서브에이전트의 설명과 일치하는 작업을 만나면 해당 서브에이전트에 위임하고, 서브에이전트는 독립적으로 작업하여 결과를 반환합니다.

서브에이전트는 다음과 같은 이점을 제공합니다:

* **컨텍스트 보존** - 탐색과 구현을 메인 대화에서 분리
* **제약 조건 적용** - 서브에이전트가 사용할 수 있는 도구 제한
* **구성 재사용** - 사용자 수준의 서브에이전트를 프로젝트 간에 재사용
* **동작 특화** - 특정 도메인을 위한 집중된 시스템 프롬프트
* **비용 절감** - Haiku와 같은 더 빠르고 저렴한 모델로 작업 라우팅

Claude는 각 서브에이전트의 설명을 사용하여 작업을 위임할 시기를 결정합니다. 서브에이전트를 생성할 때, Claude가 언제 사용해야 하는지 알 수 있도록 명확한 설명을 작성하세요.

Claude Code에는 **Explore**, **Plan**, **general-purpose**와 같은 내장 서브에이전트가 포함되어 있습니다. 특정 작업을 처리하기 위한 커스텀 서브에이전트도 생성할 수 있습니다.

## 내장 서브에이전트

Claude Code에는 Claude가 적절할 때 자동으로 사용하는 내장 서브에이전트가 포함되어 있습니다. 각각은 추가 도구 제한과 함께 부모 대화의 권한을 상속받습니다.

### Explore
코드베이스 검색 및 분석에 최적화된 빠른 읽기 전용 에이전트입니다.

* **모델**: Haiku (빠르고 낮은 지연 시간)
* **도구**: 읽기 전용 도구 (Write 및 Edit 도구 액세스 거부)
* **목적**: 파일 검색, 코드 검색, 코드베이스 탐색

Claude는 변경 없이 코드베이스를 검색하거나 이해해야 할 때 Explore에 위임합니다. 이렇게 하면 탐색 결과가 메인 대화 컨텍스트에서 분리됩니다.

Explore를 호출할 때 Claude는 철저함 수준을 지정합니다: 타겟 조회를 위한 **quick**, 균형 잡힌 탐색을 위한 **medium**, 포괄적인 분석을 위한 **very thorough**.

### Plan
계획을 제시하기 전에 컨텍스트를 수집하기 위해 계획 모드 중에 사용되는 연구 에이전트입니다.

* **모델**: 메인 대화에서 상속
* **도구**: 읽기 전용 도구 (Write 및 Edit 도구 액세스 거부)
* **목적**: 계획을 위한 코드베이스 연구

계획 모드에서 Claude가 코드베이스를 이해해야 할 때, Plan 서브에이전트에 연구를 위임합니다. 이는 무한 중첩을 방지하면서(서브에이전트는 다른 서브에이전트를 생성할 수 없음) 필요한 컨텍스트를 수집합니다.

### General-purpose
탐색과 작업이 모두 필요한 복잡한 다단계 작업을 위한 유능한 에이전트입니다.

* **모델**: 메인 대화에서 상속
* **도구**: 모든 도구
* **목적**: 복잡한 연구, 다단계 작업, 코드 수정

Claude는 탐색과 수정이 모두 필요하거나, 결과 해석을 위한 복잡한 추론, 여러 종속 단계가 필요한 작업을 general-purpose에 위임합니다.

## 빠른 시작: 첫 서브에이전트 만들기

서브에이전트는 YAML frontmatter가 있는 마크다운 파일로 정의됩니다. 수동으로 생성하거나 `/agents` 명령을 사용할 수 있습니다.

이 워크스루는 `/agents` 명령으로 사용자 수준 서브에이전트를 생성하는 과정을 안내합니다. 서브에이전트는 코드를 검토하고 코드베이스에 대한 개선 사항을 제안합니다.

### 1단계: 서브에이전트 인터페이스 열기
Claude Code에서 실행:
```
/agents
```

### 2단계: 새 사용자 수준 에이전트 생성
**Create new agent**를 선택한 다음 **User-level**을 선택합니다. 이렇게 하면 서브에이전트가 `~/.claude/agents/`에 저장되어 모든 프로젝트에서 사용할 수 있습니다.

### 3단계: Claude로 생성
**Generate with Claude**를 선택합니다. 메시지가 표시되면 서브에이전트를 설명합니다:

```
파일을 스캔하고 가독성, 성능 및 모범 사례에 대한 개선 사항을 제안하는 코드 개선 에이전트입니다.
각 문제를 설명하고 현재 코드를 표시하며 개선된 버전을 제공해야 합니다.
```

Claude가 시스템 프롬프트와 구성을 생성합니다. 커스터마이즈하려면 `e`를 눌러 에디터에서 열 수 있습니다.

### 4단계: 도구 선택
읽기 전용 리뷰어의 경우 **Read-only tools**를 제외한 모든 항목을 선택 해제합니다. 모든 도구를 선택한 상태로 두면 서브에이전트는 메인 대화에서 사용 가능한 모든 도구를 상속받습니다.

### 5단계: 모델 선택
서브에이전트가 사용할 모델을 선택합니다. 이 예제 에이전트의 경우 코드 패턴 분석을 위해 기능과 속도의 균형을 맞추는 **Sonnet**을 선택합니다.

### 6단계: 색상 선택
서브에이전트의 배경색을 선택합니다. 이는 UI에서 어떤 서브에이전트가 실행 중인지 식별하는 데 도움이 됩니다.

### 7단계: 저장하고 사용해 보기
서브에이전트를 저장합니다. 즉시 사용할 수 있습니다(재시작 불필요). 사용해 보세요:

```
code-improver 에이전트를 사용하여 이 프로젝트의 개선 사항을 제안하세요
```

Claude가 새 서브에이전트에 위임하고, 서브에이전트는 코드베이스를 스캔하여 개선 제안을 반환합니다.

## 서브에이전트 구성

### /agents 명령 사용

`/agents` 명령은 서브에이전트 관리를 위한 대화형 인터페이스를 제공합니다. `/agents`를 실행하면:

* 사용 가능한 모든 서브에이전트 보기 (내장, 사용자, 프로젝트 및 플러그인)
* 가이드 설정 또는 Claude 생성으로 새 서브에이전트 생성
* 기존 서브에이전트 구성 및 도구 액세스 편집
* 커스텀 서브에이전트 삭제
* 중복이 있을 때 어떤 서브에이전트가 활성인지 확인

서브에이전트를 생성하고 관리하는 권장 방법입니다.

### 서브에이전트 범위 선택

서브에이전트는 YAML frontmatter가 있는 마크다운 파일입니다. 범위에 따라 다른 위치에 저장합니다. 여러 서브에이전트가 동일한 이름을 공유하면 우선순위가 높은 위치가 우선합니다.

| 위치 | 범위 | 우선순위 | 생성 방법 |
|:-----|:-----|:--------|:---------|
| `--agents` CLI 플래그 | 현재 세션 | 1 (최고) | Claude Code 실행 시 JSON 전달 |
| `.claude/agents/` | 현재 프로젝트 | 2 | 대화형 또는 수동 |
| `~/.claude/agents/` | 모든 프로젝트 | 3 | 대화형 또는 수동 |
| 플러그인의 `agents/` 디렉토리 | 플러그인이 활성화된 곳 | 4 (최저) | 플러그인과 함께 설치 |

**프로젝트 서브에이전트** (`.claude/agents/`)는 코드베이스별 서브에이전트에 이상적입니다. 팀이 사용하고 협업적으로 개선할 수 있도록 버전 관리에 체크인하세요.

**사용자 서브에이전트** (`~/.claude/agents/`)는 모든 프로젝트에서 사용 가능한 개인 서브에이전트입니다.

### 서브에이전트 파일 작성

서브에이전트 파일은 구성을 위한 YAML frontmatter를 사용하고, 그 뒤에 마크다운으로 된 시스템 프롬프트가 옵니다:

```markdown
---
name: code-reviewer
description: 품질과 모범 사례를 위한 코드 검토
tools: Read, Glob, Grep
model: sonnet
---

당신은 코드 리뷰어입니다. 호출되면 코드를 분석하고 품질, 보안 및 모범 사례에 대한
구체적이고 실행 가능한 피드백을 제공하세요.
```

frontmatter는 서브에이전트의 메타데이터와 구성을 정의합니다. 본문은 서브에이전트의 동작을 안내하는 시스템 프롬프트가 됩니다.

#### 지원되는 frontmatter 필드

| 필드 | 필수 | 설명 |
|:----|:-----|:----|
| `name` | 예 | 소문자와 하이픈을 사용한 고유 식별자 |
| `description` | 예 | Claude가 이 서브에이전트에 위임해야 하는 시기 |
| `tools` | 아니오 | 서브에이전트가 사용할 수 있는 도구. 생략하면 모든 도구 상속 |
| `disallowedTools` | 아니오 | 거부할 도구, 상속 또는 지정된 목록에서 제거 |
| `model` | 아니오 | 사용할 모델: `sonnet`, `opus`, `haiku` 또는 `inherit`. 기본값은 `inherit` |
| `permissionMode` | 아니오 | 권한 모드: `default`, `acceptEdits`, `dontAsk`, `bypassPermissions` 또는 `plan` |
| `skills` | 아니오 | 시작 시 서브에이전트의 컨텍스트에 로드할 스킬 |
| `hooks` | 아니오 | 이 서브에이전트에 범위가 지정된 라이프사이클 훅 |

### 모델 선택

`model` 필드는 서브에이전트가 사용하는 AI 모델을 제어합니다:

* **모델 별칭**: 사용 가능한 별칭 중 하나 사용: `sonnet`, `opus` 또는 `haiku`
* **inherit**: 메인 대화와 동일한 모델 사용
* **생략**: 지정하지 않으면 기본값은 `inherit` (메인 대화와 동일한 모델 사용)

### 서브에이전트 기능 제어

도구 액세스, 권한 모드 및 조건부 규칙을 통해 서브에이전트가 수행할 수 있는 작업을 제어할 수 있습니다.

#### 사용 가능한 도구

서브에이전트는 Claude Code의 내부 도구를 사용할 수 있습니다. 기본적으로 서브에이전트는 MCP 도구를 포함하여 메인 대화의 모든 도구를 상속받습니다.

도구를 제한하려면 `tools` 필드(허용 목록) 또는 `disallowedTools` 필드(거부 목록)를 사용합니다:

```yaml
---
name: safe-researcher
description: 제한된 기능을 가진 연구 에이전트
tools: Read, Grep, Glob, Bash
disallowedTools: Write, Edit
---
```

#### 권한 모드

`permissionMode` 필드는 서브에이전트가 권한 프롬프트를 처리하는 방법을 제어합니다.

| 모드 | 동작 |
|:----|:-----|
| `default` | 프롬프트와 함께 표준 권한 검사 |
| `acceptEdits` | 파일 편집 자동 승인 |
| `dontAsk` | 권한 프롬프트 자동 거부 (명시적으로 허용된 도구는 여전히 작동) |
| `bypassPermissions` | 모든 권한 검사 건너뛰기 |
| `plan` | 계획 모드 (읽기 전용 탐색) |

### 서브에이전트 작업하기

#### 자동 위임

Claude는 요청의 작업 설명, 서브에이전트 구성의 `description` 필드 및 현재 컨텍스트를 기반으로 작업을 자동으로 위임합니다. 사전 위임을 장려하려면 서브에이전트의 description 필드에 "사전에 사용"과 같은 문구를 포함하세요.

특정 서브에이전트를 명시적으로 요청할 수도 있습니다:

```
test-runner 서브에이전트를 사용하여 실패한 테스트를 수정하세요
code-reviewer 서브에이전트가 최근 변경 사항을 확인하게 하세요
```

#### 서브에이전트 재개

각 서브에이전트 호출은 새로운 컨텍스트로 새 인스턴스를 생성합니다. 처음부터 시작하는 대신 기존 서브에이전트의 작업을 계속하려면 Claude에게 재개하도록 요청하세요.

재개된 서브에이전트는 모든 이전 도구 호출, 결과 및 추론을 포함하여 전체 대화 기록을 유지합니다.

## 예제 서브에이전트

### 코드 리뷰어

코드를 수정하지 않고 검토하는 읽기 전용 서브에이전트입니다:

```markdown
---
name: code-reviewer
description: 전문 코드 검토 전문가. 코드 작성 또는 수정 직후에 즉시 사용하세요.
tools: Read, Grep, Glob, Bash
model: inherit
---

당신은 높은 코드 품질 및 보안 표준을 보장하는 시니어 코드 리뷰어입니다.

호출될 때:
1. git diff를 실행하여 최근 변경 사항 확인
2. 수정된 파일에 집중
3. 즉시 검토 시작

검토 체크리스트:
- 코드가 명확하고 읽기 쉬움
- 함수와 변수가 잘 명명됨
- 중복 코드 없음
- 적절한 오류 처리
- 노출된 시크릿 또는 API 키 없음
- 입력 검증 구현
- 좋은 테스트 커버리지
- 성능 고려사항 처리됨

우선순위별로 피드백 제공:
- 중요 문제 (반드시 수정)
- 경고 (수정해야 함)
- 제안 (개선 고려)

문제를 수정하는 방법의 구체적인 예를 포함하세요.
```

### 디버거

문제를 분석하고 수정할 수 있는 서브에이전트입니다:

```markdown
---
name: debugger
description: 오류, 테스트 실패 및 예상치 못한 동작을 위한 디버깅 전문가. 문제 발생 시 사전에 사용하세요.
tools: Read, Edit, Bash, Grep, Glob
---

당신은 근본 원인 분석을 전문으로 하는 전문 디버거입니다.

호출될 때:
1. 오류 메시지 및 스택 추적 캡처
2. 재현 단계 식별
3. 실패 위치 격리
4. 최소 수정 구현
5. 솔루션 작동 확인

디버깅 프로세스:
- 오류 메시지 및 로그 분석
- 최근 코드 변경 사항 확인
- 가설 형성 및 테스트
- 전략적 디버그 로깅 추가
- 변수 상태 검사

각 문제에 대해 제공:
- 근본 원인 설명
- 진단을 뒷받침하는 증거
- 구체적인 코드 수정
- 테스트 접근 방식
- 예방 권장 사항

증상이 아닌 근본적인 문제를 수정하는 데 집중하세요.
```

### 데이터 사이언티스트

데이터 분석 작업을 위한 도메인별 서브에이전트입니다:

```markdown
---
name: data-scientist
description: SQL 쿼리, BigQuery 작업 및 데이터 인사이트를 위한 데이터 분석 전문가. 데이터 분석 작업 및 쿼리에 사전에 사용하세요.
tools: Bash, Read, Write
model: sonnet
---

당신은 SQL 및 BigQuery 분석을 전문으로 하는 데이터 사이언티스트입니다.

호출될 때:
1. 데이터 분석 요구 사항 이해
2. 효율적인 SQL 쿼리 작성
3. 적절한 경우 BigQuery 명령줄 도구(bq) 사용
4. 결과 분석 및 요약
5. 명확하게 결과 제시

주요 관행:
- 적절한 필터가 있는 최적화된 SQL 쿼리 작성
- 적절한 집계 및 조인 사용
- 복잡한 로직을 설명하는 주석 포함
- 가독성을 위한 결과 형식 지정
- 데이터 기반 권장 사항 제공

각 분석에 대해:
- 쿼리 접근 방식 설명
- 가정 문서화
- 주요 결과 강조
- 데이터를 기반으로 다음 단계 제안

항상 쿼리가 효율적이고 비용 효율적인지 확인하세요.
```

## 다음 단계

이제 서브에이전트를 이해했으므로 다음 관련 기능을 살펴보세요:

* 플러그인으로 서브에이전트 배포하여 팀 또는 프로젝트 간에 공유
* Agent SDK로 Claude Code를 프로그래밍 방식으로 실행하여 CI/CD 및 자동화
* MCP 서버를 사용하여 서브에이전트에 외부 도구 및 데이터 액세스 제공
