# Nanobanana 3.0 Pro Generator 가이드

나노바나나 3.0 Pro (Google Imagen 3)를 사용한 AI 이미지 생성기

## 개요

NanobananGenerator는 Google의 Imagen 3 모델을 활용하여 블로그용 고품질 이미지를 생성합니다.

### 주요 기능

- 4가지 이미지 유형 지원 (썸네일, 배너, 푸드 포토, 인포그래픽)
- 5가지 스타일 프리셋 (food, travel, lifestyle, tech, default)
- 자동 재시도 로직
- 커스텀 프롬프트 지원
- 외부 템플릿 파일 로드

## 설치

### 필수 패키지

```bash
pip install google-genai
```

### API 키 설정

```bash
export GOOGLE_API_KEY="your_api_key_here"
```

또는 코드에서 직접 설정:

```python
generator = NanobananGenerator(api_key="your_api_key")
```

## 사용법

### 기본 사용

```python
import asyncio
from src.collectors.nanobanana import NanobananGenerator

async def main():
    generator = NanobananGenerator()

    # 썸네일 이미지 생성
    result = await generator.collect(
        keywords=["맛집", "리뷰"],
        max_images=1,
        image_type="thumbnail",
        style="food"
    )

    if result.success:
        img = result.images[0]
        generator.save_image(img['data'], "output/thumbnail.png")

asyncio.run(main())
```

### 이미지 유형

#### 1. Thumbnail (썸네일)
- 비율: 16:9 (1024x576)
- 용도: 블로그 포스트 썸네일
- 특징: 텍스트 오버레이 공간 확보

```python
result = await generator.collect(
    keywords=["여행", "제주도"],
    image_type="thumbnail",
    style="travel"
)
```

#### 2. Banner (배너)
- 비율: 16:9 (1024x576)
- 용도: 블로그 상단 배너
- 특징: 미니멀 디자인, 그라데이션 배경

```python
result = await generator.collect(
    keywords=["기술", "블로그"],
    image_type="banner",
    style="tech"
)
```

#### 3. Food Photo (푸드 포토)
- 비율: 4:3 (1024x768)
- 용도: 음식 리뷰 사진
- 특징: 자연광, 얕은 심도, 한식 세팅

```python
result = await generator.collect(
    keywords=["김치찌개", "한식"],
    image_type="food_photo",
    style="food"
)
```

#### 4. Infographic (인포그래픽)
- 비율: 1:1 (1024x1024)
- 용도: 카드뉴스, 정보 시각화
- 특징: 플랫 디자인, 아이콘, 한글 친화적

```python
result = await generator.collect(
    keywords=["건강", "팁", "5가지"],
    image_type="infographic",
    style="lifestyle",
    brand_color="green"
)
```

### 스타일 프리셋

- **food**: 따뜻한 조명, 식욕을 돋우는 비주얼
- **travel**: 생생한 색감, 영화 같은 풍경
- **lifestyle**: 자연스러운, 현대적인 라이프스타일
- **tech**: 세련된, 미래적, 깔끔한 기술
- **default**: 전문적인, 고품질, 매력적인

### 직접 이미지 생성

```python
generator = NanobananGenerator()

# 세밀한 제어가 필요한 경우
generated = await generator.generate_image(
    prompt="서울 야경",
    image_type="banner",
    style="travel",
    negative_prompt="people, cars, traffic"
)

if generated:
    generator.save_image(generated.data, "output/custom.png")
```

### 배치 생성

```python
# 여러 이미지 동시 생성
tasks = [
    generator.collect(keywords=["여행"], image_type="thumbnail"),
    generator.collect(keywords=["음식"], image_type="food_photo"),
    generator.collect(keywords=["정보"], image_type="infographic")
]

results = await asyncio.gather(*tasks)

for idx, result in enumerate(results):
    if result.success:
        img = result.images[0]
        generator.save_image(img['data'], f"output/batch_{idx}.png")
```

### 외부 템플릿 사용

```python
generator = NanobananGenerator()

# 템플릿 파일 로드
template = generator.load_prompt_template(
    "config/prompts/nanobanana_food.txt"
)

# 포맷팅
formatted = template.format(dish_name="불고기")
print(formatted)
```

## 프롬프트 커스터마이징

### 템플릿 파일 구조

`config/prompts/nanobanana_thumbnail.txt`:
```
Professional blog thumbnail for {topic},
clean composition with space for text overlay,
{style} aesthetic, high quality photography,
16:9 aspect ratio, modern design
```

### 변수

- `{topic}`: 주제/키워드
- `{style}`: 스타일 설명
- `{brand_color}`: 브랜드 색상 (인포그래픽용)
- `{dish_name}`: 요리 이름 (푸드 포토용)

## 재시도 로직

API 실패 시 자동으로 재시도합니다.

```python
# 기본값: 3회 재시도
generator = NanobananGenerator(max_retries=3)

# 재시도 없이 1회만 시도
generator = NanobananGenerator(max_retries=1)
```

## 응답 구조

### CollectorResult

```python
{
    "success": True,
    "images": [
        {
            "url": "data:image/png;base64,...",  # 미리보기용
            "data": b"...",  # 실제 이미지 바이트
            "width": 1024,
            "height": 576,
            "attribution": "AI Generated by Nanobanana 3.0 Pro (Imagen 3)",
            "source": "nanobanana",
            "prompt": "...",  # 사용된 프롬프트
            "image_type": "thumbnail",
            "style": "food"
        }
    ],
    "error": None
}
```

## 에러 처리

```python
try:
    generator = NanobananGenerator()
    result = await generator.collect(keywords=["테스트"])

    if not result.success:
        print(f"생성 실패: {result.error}")

except ValueError as e:
    print(f"API 키 오류: {e}")
except Exception as e:
    print(f"예상치 못한 오류: {e}")
```

## 모범 사례

### 1. 명확한 키워드 사용

```python
# 좋은 예
keywords=["맛집", "한식", "분위기 좋은"]

# 나쁜 예
keywords=["음식"]  # 너무 광범위
```

### 2. 적절한 이미지 유형 선택

```python
# 블로그 포스트 헤더 -> thumbnail
# 음식 리뷰 -> food_photo
# 정보 전달 -> infographic
```

### 3. 스타일 일관성 유지

```python
# 블로그 전체에서 동일한 스타일 사용
style = "food"  # 맛집 블로그
style = "travel"  # 여행 블로그
```

### 4. Negative Prompt 활용

```python
# 원하지 않는 요소 제거
negative_prompt="people, text, watermark, blurry"
```

## 성능 최적화

### 배치 처리

```python
# 순차 처리 (느림)
for keyword in keywords:
    result = await generator.collect(keywords=[keyword])

# 병렬 처리 (빠름)
tasks = [generator.collect(keywords=[kw]) for kw in keywords]
results = await asyncio.gather(*tasks)
```

### 이미지 크기 최적화

Imagen 3는 기본적으로 1024px 해상도를 생성합니다. 필요에 따라 리사이징을 고려하세요.

```python
from PIL import Image
from io import BytesIO

# 이미지 리사이징
img = Image.open(BytesIO(image_data))
img_resized = img.resize((512, 288))  # 50% 축소
img_resized.save("output/resized.png")
```

## 제한사항

- 하루 API 호출 제한 확인 필요
- 생성 시간: 이미지당 약 5-10초
- 최대 해상도: 1024px
- 종횡비: 16:9, 4:3, 1:1만 지원

## 라이선스 및 저작권

생성된 이미지에는 다음 attribution이 자동으로 포함됩니다:

```
AI Generated by Nanobanana 3.0 Pro (Imagen 3)
```

블로그 게시 시 AI 생성 이미지임을 명시하는 것을 권장합니다.

## 문제 해결

### API 키 오류

```
ValueError: GOOGLE_API_KEY 환경변수 필요
```

→ 환경변수 설정 또는 코드에서 직접 전달

### 생성 실패

```
AI 이미지 생성 실패 (모든 재시도 소진)
```

→ API 할당량 확인, 프롬프트 수정, 재시도 횟수 증가

### 안전 필터

일부 키워드는 안전 필터에 의해 차단될 수 있습니다. 중립적인 표현으로 변경하세요.

## 참고 자료

- [Google Imagen 3 문서](https://ai.google.dev/gemini-api/docs/imagen)
- [google-genai Python SDK](https://github.com/googleapis/python-genai)
